<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title> Upload files </title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<h1>Upload Files</h1>
<!-- HTML5 Input Form Elements -->
<input type="file" id="fileInput" multiple>
<button id="upload-button" onclick="uploadFiles()"> Upload </button>
<div class="file-list">
    <h2>Selected Files for Upload</h2>
    <ul id="fileList"></ul>
</div>
<div id="notification" class="alert alert-success mt-2" style="display: none;">
    <!--notification -->
</div>
<script>
    let selectedFiles = [];
    const notification = document.getElementById('notification');
    
    // Handle file selection
    document.getElementById('fileInput').addEventListener('change', function(event) {
        selectedFiles = Array.from(event.target.files);
        updateFileList();
    });
    
    // Update the file list on the UI
    function updateFileList() {
        const fileList = document.getElementById('fileList');
        fileList.innerHTML = ''; // Clear the list before updating
        
        selectedFiles.forEach(file => {
            const listItem = document.createElement('li');
            listItem.className = 'file-item';
            listItem.textContent = file.name;
            fileList.appendChild(listItem);
        });
    }
    
    async function uploadFiles() {
        let formData = new FormData();
        selectedFiles.forEach(file => {
            formData.append('files', file);
        });
        try {
            const response = await fetch('/files/upload/batch', {
                method: 'POST',
                body: formData
            });
            
            if (response.ok) {
                notification.style.display = 'block';
                notification.className = 'alert alert-success mt-2';
                notification.innerHTML = `<p>Files uploaded successfully!</p>`;
                selectedFiles = []; // Clear selected files
                updateFileList();
                window.location.href = '/files';
            } else {
                notification.style.display = 'block';
                notification.className = 'alert alert-danger mt-2';
                notification.innerHTML = `<p>Failed to upload files.</p>`;
                selectedFiles = [];
            }
        } catch (error) {
            console.error('Error uploading files:', error);
            notification.style.display = 'block';
            notification.className = 'alert alert-danger mt-2';
            notification.innerHTML = `<p>Failed to upload files.</p>`;
        }
    }
</script>

</body>
</html>